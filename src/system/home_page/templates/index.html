<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ service_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <style>
        body { padding-top: 64px; }
        .container { max-width: 960px; }
        table { margin-top: 1rem; width: 50%; font-size: 0.9rem; }
        .card { width: 50%; margin: auto; }
        .card .card-content { font-size: 0.9rem; }
    </style>
</head>
<body>
    <nav class="blue darken-3">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo">{{ service_name }}</a>
        </div>
    </nav>
    <div class="container" style="margin-top: 1rem;">
    </div>
    <main class="container">
        <a href="/docs" class="btn">Swagger UI</a>
        <a href="https://github.com/andreynorvatov/fastapi-starter" class="btn" target="_blank">GitHub</a>
        <a href="https://frontend-placeholder.example.com" class="btn" target="_blank">Frontend</a>

        <h2 class="header">Настройки приложения</h2>
        <ul>
            <li>Проект: {{ settings.PROJECT_NAME }}</li>
            <li>Окружение: {{ settings.ENVIRONMENT }}</li>
            <li>База данных: {{ settings.SQLALCHEMY_DATABASE_URI }}</li>
            <li>Размер пула: {{ settings.DB_POOL_SIZE }}</li>
            <li>Максимальный переполняющий пул: {{ settings.DB_MAX_OVERFLOW }}</li>
            <li>Таймаут пула: {{ settings.DB_POOL_TIMEOUT }}</li>
            <li>Переработка пула: {{ settings.DB_POOL_RECYCLE }}</li>
            <li>Проверка соединения: {{ settings.DB_POOL_PRE_PING }}</li>
            <li>Версия: {{ settings.APP_VERSION }}</li>
        </ul>

        <h2 class="header">Схема базы данных</h2>
        {% if tables %}
        <div class="row">
            {% for table in tables %}
                <div class="col s6">
                    <ul class="collapsible">
                        <li>
                            <div class="collapsible-header"><span class="card-title">Таблица: {{ table.name }}</span></div>
                            <div class="collapsible-body">
                                <table class="highlight">
                                    <thead>
                                        <tr><th>Колонка</th><th>Тип</th><th>Описание</th></tr>
                                    </thead>
                                    <tbody>
                                        {% for column in table.columns %}
                                            <tr><td>{{ column[0] }}</td><td>{{ column[1] }}</td><td>{{ column[2] if column|length > 2 else '' }}</td></tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% if table.foreign_keys %}
                                    <h6>Связи (Foreign Keys)</h6>
                                    <table class="highlight">
                                        <thead>
                                            <tr><th>Колонка</th><th>Таблица</th><th>Колонка</th></tr>
                                        </thead>
                                        <tbody>
                                            {% for fk in table.foreign_keys %}
                                                <tr><td>{{ fk.column }}</td><td>{{ fk.referred_table }}</td><td>{{ fk.referred_column }}</td></tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            </div>
                        </li>
                    </ul>
                </div>
            {% endfor %}
        </div>
        {% else %}
            <p>Схема базы данных не найдена.</p>
        {% endif %}
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.collapsible');
            M.Collapsible.init(elems, {});
        });
    </script>
</body>
</html>